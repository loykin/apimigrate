up:
  name: create sample user in sample realm
  env:
    firstname: Sample
    lastname: User
  request:
    auth_name: keycloak
    method: POST
    url: "{{.kc_base}}/admin/realms/{{.realm}}/users"
    headers: []
    queries: []
    body: |
      {
        "username": "{{.username}}",
        "enabled": true,
        "email": "{{.username}}@example.com",
        "firstName": "{{.firstname}}",
        "lastName": "{{.lastname}}",
        "credentials": [
          { "type": "password", "value": "{{.password}}", "temporary": false }
        ]
      }
  response:
    # 201: created, 409: already exists
    result_code: ["201", "409"]

down:
  name: delete sample user
  auth: keycloak
  env: {}
  # First, find the user's internal id by username, then delete by id
  find:
    request:
      auth_name: keycloak
      method: GET
      url: "{{.kc_base}}/admin/realms/{{.realm}}/users?username={{.username}}&exact=true"
      headers: []
      queries: []
      body: ""
    response:
      result_code: ["200"]
      env_from:
        user_id: "0.id"
  method: DELETE
  url: "{{.kc_base}}/admin/realms/{{.realm}}/users/{{.user_id}}"
  headers: []
  queries: []
  body: ""
